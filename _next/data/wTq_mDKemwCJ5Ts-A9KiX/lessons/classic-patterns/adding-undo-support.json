{"pageProps":{"post":{"attributes":{},"html":"<p>We will implement the Memento design pattern to make the app capable of undoing commands.</p>\n<h1 id=\"creating-the-pattern\">Creating the pattern</h1>\n<p>Create the file <code>webapp/memento.js</code> with the following content:</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">import</span> { <span class=\"hljs-title class_\">TodoList</span> } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;./classes.js&quot;</span>\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> <span class=\"hljs-title class_\">TodoHistory</span> = {\n    <span class=\"hljs-attr\">history</span>: [],\n    <span class=\"hljs-title function_\">push</span>(<span class=\"hljs-params\">state</span>) { \n        <span class=\"hljs-keyword\">if</span> (state) {\n            <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">history</span>.<span class=\"hljs-title function_\">push</span>(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Set</span>([...state])) \n        }\n    },\n    <span class=\"hljs-title function_\">pop</span>(<span class=\"hljs-params\"></span>) { \n        <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">history</span>.<span class=\"hljs-property\">length</span>&gt;<span class=\"hljs-number\">1</span>) {\n            <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">history</span>.<span class=\"hljs-title function_\">pop</span>();\n            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">history</span>.<span class=\"hljs-title function_\">pop</span>();\n        }\n     }\n}\n\n<span class=\"hljs-title class_\">TodoList</span>.<span class=\"hljs-title function_\">getInstance</span>().<span class=\"hljs-title function_\">addObserver</span>(<span class=\"hljs-function\">()=&gt;</span> {\n    <span class=\"hljs-title class_\">TodoHistory</span>.<span class=\"hljs-title function_\">push</span>(<span class=\"hljs-title class_\">TodoList</span>.<span class=\"hljs-title function_\">getInstance</span>().<span class=\"hljs-property\">items</span>);\n})\n</code></pre>\n<h1 id=\"adding-a-new-command\">Adding a new command</h1>\n<p>Change the <code>command.js</code> file, first adding a new command</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> <span class=\"hljs-title class_\">Commands</span> = {\n    <span class=\"hljs-comment\">//...</span>\n    <span class=\"hljs-attr\">UNDO</span>: <span class=\"hljs-string\">&quot;undo&quot;</span>,\n}\n</code></pre>\n<p>And then adding the controller code in the switch:</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-comment\">// ...</span>\n<span class=\"hljs-keyword\">case</span> <span class=\"hljs-title class_\">Commands</span>.<span class=\"hljs-property\">UNDO</span>:\n    <span class=\"hljs-keyword\">const</span> previousList = <span class=\"hljs-title class_\">TodoHistory</span>.<span class=\"hljs-title function_\">pop</span>();\n    <span class=\"hljs-keyword\">if</span> (previousList) {\n        todoList.<span class=\"hljs-title function_\">replaceList</span>(previousList);\n    }\n<span class=\"hljs-comment\">// ...    </span>\n</code></pre>\n<h1 id=\"adding-a-new-keyboard-shortcut\">Adding a new keyboard shortcut</h1>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">if</span> (event.<span class=\"hljs-property\">ctrlKey</span> &amp;&amp; event.<span class=\"hljs-property\">key</span> === <span class=\"hljs-string\">&#x27;z&#x27;</span>) {\n        event.<span class=\"hljs-title function_\">preventDefault</span>(); \n        <span class=\"hljs-keyword\">const</span> cmd = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Command</span>(<span class=\"hljs-title class_\">Commands</span>.<span class=\"hljs-property\">UNDO</span>);\n        <span class=\"hljs-title class_\">CommandExecutor</span>.<span class=\"hljs-title function_\">execute</span>(cmd);\n    } \n</code></pre>\n","slug":"adding-undo-support","title":"Adding Undo Support","section":"Classic Patterns","icon":"tachometer-alt","filePath":"/Users/firt/Library/Mobile Documents/com~apple~CloudDocs/Trainings/FEM2024/WebAppPatterns/companion-src/lessons/02-classic-patterns/I-adding-undo-support.md","nextSlug":"/webapp-patterns/lessons/single-page-applications/setting-up-the-project","prevSlug":"/webapp-patterns/lessons/classic-patterns/adding-keyboard-shortcuts"}},"__N_SSG":true}